<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>后台监控 - 化学学习平台</title>
    <!-- Element Plus 样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <!-- 自定义样式 -->
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background-color: #409EFF;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
        }
        .footer {
            margin-top: 20px;
            text-align: center;
            color: #909399;
        }
        .login-form {
            max-width: 400px;
            margin: 0 auto;
            padding: 40px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
            margin-top: 100px;
        }
        .login-form h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #303133;
        }
    </style>
</head>
<body>
    <!-- 登录页面 -->
    <div v-if="!isLoggedIn" class="login-form">
        <h2>后台监控登录</h2>
        <el-form :model="loginForm" label-width="80px">
            <el-form-item label="用户名">
                <el-input v-model="loginForm.username" placeholder="请输入用户名"></el-input>
            </el-form-item>
            <el-form-item label="密码">
                <el-input v-model="loginForm.password" type="password" placeholder="请输入密码"></el-input>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" class="w-100" @click="handleLogin">登录</el-button>
            </el-form-item>
        </el-form>
    </div>

    <!-- 后台监控页面 -->
    <div v-else class="container">
        <!-- 头部 -->
        <div class="header">
            <h1>后台监控系统</h1>
            <p>用户注册信息管理</p>
        </div>

        <!-- 内容区 -->
        <div class="content">
            <!-- 标签页 -->
            <el-tabs v-model="activeTab">
                <el-tab-pane label="用户列表" name="userList">
                    <!-- 搜索和筛选 -->
                    <div class="mb-4">
                        <el-row :gutter="20">
                            <el-col :span="8">
                                <el-input v-model="searchQuery" placeholder="搜索用户名或邮箱" prefix-icon="el-icon-search" @keyup.enter="loadUsers"></el-input>
                            </el-col>
                            <el-col :span="8">
                                <el-select v-model="roleFilter" placeholder="按角色筛选" @change="loadUsers">
                                    <el-option label="全部" value=""></el-option>
                                    <el-option label="管理员" value="ADMIN"></el-option>
                                    <el-option label="用户" value="USER"></el-option>
                                </el-select>
                            </el-col>
                            <el-col :span="8">
                                <el-button type="primary" @click="loadUsers">查询</el-button>
                                <el-button @click="resetFilters">重置</el-button>
                            </el-col>
                        </el-row>
                    </div>

                    <!-- 用户列表表格 -->
                    <el-table :data="usersData" style="width: 100%">
                        <el-table-column prop="id" label="ID" width="80"></el-table-column>
                        <el-table-column prop="username" label="用户名"></el-table-column>
                        <el-table-column prop="email" label="邮箱"></el-table-column>
                        <el-table-column prop="role" label="角色" width="100">
                            <template #default="scope">
                                <el-tag :type="scope.row.role === 'ADMIN' ? 'danger' : 'success'">
                                    {{ scope.row.role === 'ADMIN' ? '管理员' : '用户' }}
                                </el-tag>
                            </template>
                        </el-table-column>
                        <el-table-column prop="enabled" label="状态" width="100">
                            <template #default="scope">
                                <el-switch v-model="scope.row.enabled" @change="updateUserStatus(scope.row)"></el-switch>
                            </template>
                        </el-table-column>
                        <el-table-column label="操作" width="150">
                            <template #default="scope">
                                <el-button size="small" type="primary" @click="viewUserDetails(scope.row)">查看</el-button>
                                <el-button size="small" type="danger" @click="deleteUser(scope.row.id)">删除</el-button>
                            </template>
                        </el-table-column>
                    </el-table>

                    <!-- 分页 -->
                    <div class="mt-4">
                        <el-pagination
                            v-model:current-page="currentPage"
                            v-model:page-size="pageSize"
                            :page-sizes="[10, 20, 50, 100]"
                            layout="total, sizes, prev, pager, next, jumper"
                            :total="totalUsers"
                            @size-change="handleSizeChange"
                            @current-change="handleCurrentChange"
                        ></el-pagination>
                    </div>
                </el-tab-pane>

                <el-tab-pane label="注册信息" name="registerInfo">
                    <!-- 注册信息统计 -->
                    <div class="mb-4">
                        <el-row :gutter="20">
                            <el-col :span="6">
                                <el-card shadow="hover">
                                    <template #header>
                                        <div class="card-header">
                                            <span>总用户数</span>
                                        </div>
                                    </template>
                                    <div class="text-center">
                                        <span class="text-xl">{{ totalUsers }}</span>
                                    </div>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card shadow="hover">
                                    <template #header>
                                        <div class="card-header">
                                            <span>活跃用户</span>
                                        </div>
                                    </template>
                                    <div class="text-center">
                                        <span class="text-xl">{{ activeUsers }}</span>
                                    </div>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card shadow="hover">
                                    <template #header>
                                        <div class="card-header">
                                            <span>管理员用户</span>
                                        </div>
                                    </template>
                                    <div class="text-center">
                                        <span class="text-xl">{{ adminUsers }}</span>
                                    </div>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card shadow="hover">
                                    <template #header>
                                        <div class="card-header">
                                            <span>普通用户</span>
                                        </div>
                                    </template>
                                    <div class="text-center">
                                        <span class="text-xl">{{ normalUsers }}</span>
                                    </div>
                                </el-card>
                            </el-col>
                        </el-row>
                    </div>

                    <!-- 注册时间统计 -->
                    <div class="mb-4">
                        <el-card shadow="hover">
                            <template #header>
                                <div class="card-header">
                                    <span>注册时间分布</span>
                                </div>
                            </template>
                            <div class="h-64">
                                <!-- 这里可以添加图表，如ECharts -->
                                <div class="text-center py-12">
                                    <el-icon class="text-4xl text-gray-400"><i class="el-icon-data-analysis"></i></el-icon>
                                    <p class="mt-2 text-gray-400">注册时间分布图表</p>
                                </div>
                            </div>
                        </el-card>
                    </div>
                </el-tab-pane>
            </el-tabs>
        </div>

        <!-- 底部 -->
        <div class="footer">
            <p>© 2026 化学学习平台 - 后台监控系统</p>
        </div>
    </div>

    <!-- 用户详情对话框 -->
    <el-dialog v-model="userDetailsVisible" title="用户详情">
        <el-form :model="selectedUser" label-width="100px">
            <el-form-item label="用户ID">
                <el-input v-model="selectedUser.id" disabled></el-input>
            </el-form-item>
            <el-form-item label="用户名">
                <el-input v-model="selectedUser.username" disabled></el-input>
            </el-form-item>
            <el-form-item label="邮箱">
                <el-input v-model="selectedUser.email" disabled></el-input>
            </el-form-item>
            <el-form-item label="角色">
                <el-input v-model="selectedUser.role" disabled></el-input>
            </el-form-item>
            <el-form-item label="状态">
                <el-tag :type="selectedUser.enabled ? 'success' : 'danger'">
                    {{ selectedUser.enabled ? '启用' : '禁用' }}
                </el-tag>
            </el-form-item>
        </el-form>
    </el-dialog>

    <!-- Vue 3 脚本 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Element Plus 脚本 -->
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // 登录状态
                    isLoggedIn: false,
                    loginForm: {
                        username: 'admin',
                        password: 'admin123'
                    },
                    
                    // 标签页
                    activeTab: 'userList',
                    
                    // 用户列表
                    usersData: [],
                    totalUsers: 0,
                    currentPage: 1,
                    pageSize: 10,
                    searchQuery: '',
                    roleFilter: '',
                    
                    // 统计数据
                    activeUsers: 0,
                    adminUsers: 0,
                    normalUsers: 0,
                    
                    // 用户详情
                    userDetailsVisible: false,
                    selectedUser: {}
                };
            },
            mounted() {
                // 检查登录状态
                const token = localStorage.getItem('adminToken');
                if (token) {
                    this.isLoggedIn = true;
                    this.loadUsers();
                    this.loadStatistics();
                }
            },
            methods: {
                // 登录处理
                handleLogin() {
                    // 简单的登录验证
                    if (this.loginForm.username === 'admin' && this.loginForm.password === 'admin123') {
                        // 模拟生成token
                        const token = 'admin-token-' + Date.now();
                        localStorage.setItem('adminToken', token);
                        this.isLoggedIn = true;
                        this.loadUsers();
                        this.loadStatistics();
                    } else {
                        ElMessage.error('用户名或密码错误');
                    }
                },
                
                // 加载用户列表
                loadUsers() {
                    // 模拟API请求
                    fetch('/api/user/users')
                        .then(response => response.json())
                        .then(data => {
                            // 筛选用户
                            let filteredUsers = data;
                            
                            // 搜索筛选
                            if (this.searchQuery) {
                                filteredUsers = filteredUsers.filter(user => 
                                    user.username.toLowerCase().includes(this.searchQuery.toLowerCase()) ||
                                    user.email.toLowerCase().includes(this.searchQuery.toLowerCase())
                                );
                            }
                            
                            // 角色筛选
                            if (this.roleFilter) {
                                filteredUsers = filteredUsers.filter(user => user.role === this.roleFilter);
                            }
                            
                            // 分页
                            this.totalUsers = filteredUsers.length;
                            const startIndex = (this.currentPage - 1) * this.pageSize;
                            const endIndex = startIndex + this.pageSize;
                            this.usersData = filteredUsers.slice(startIndex, endIndex);
                        })
                        .catch(error => {
                            console.error('加载用户失败:', error);
                            ElMessage.error('加载用户失败');
                        });
                },
                
                // 加载统计数据
                loadStatistics() {
                    fetch('/api/user/users')
                        .then(response => response.json())
                        .then(data => {
                            this.totalUsers = data.length;
                            this.activeUsers = data.filter(user => user.enabled).length;
                            this.adminUsers = data.filter(user => user.role === 'ADMIN').length;
                            this.normalUsers = data.filter(user => user.role === 'USER').length;
                        })
                        .catch(error => {
                            console.error('加载统计数据失败:', error);
                        });
                },
                
                // 重置筛选条件
                resetFilters() {
                    this.searchQuery = '';
                    this.roleFilter = '';
                    this.currentPage = 1;
                    this.loadUsers();
                },
                
                // 分页处理
                handleSizeChange(size) {
                    this.pageSize = size;
                    this.loadUsers();
                },
                
                handleCurrentChange(current) {
                    this.currentPage = current;
                    this.loadUsers();
                },
                
                // 更新用户状态
                updateUserStatus(user) {
                    // 模拟更新用户状态
                    ElMessage.success(`用户 ${user.username} 状态已更新`);
                },
                
                // 查看用户详情
                viewUserDetails(user) {
                    this.selectedUser = { ...user };
                    this.userDetailsVisible = true;
                },
                
                // 删除用户
                deleteUser(userId) {
                    ElMessageBox.confirm('确定要删除这个用户吗？', '警告', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        type: 'danger'
                    })
                    .then(() => {
                        // 模拟删除用户
                        ElMessage.success('用户删除成功');
                        this.loadUsers();
                    })
                    .catch(() => {
                        // 取消删除
                    });
                }
            }
        }).use(ElementPlus).mount('body');
    </script>
</body>
</html>